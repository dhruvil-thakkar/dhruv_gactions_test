name: Dhruv Test Workflow

on:
  issues:
    types:
      - opened
  push:
    branches:
      - main

jobs:
  aws-nuke:
    runs-on: ubuntu-latest
    steps:
      - name: Log Event Payload
        run: |
          payload_body="${{ github.event.issue.body }}"
          echo "$payload_body"
          account=$(echo "$payload_body" |grep -A2 "### Account to Nuke AWS Services" | tail -n1)
          echo $account
          account_alias=$(echo "$payload_body" |grep -A2 "### Account Alias" | tail -n1)
          echo $account_alias
          excluded_resources=$(echo "$payload_body" |grep -A2 "### Excluded Resources" | tail -n1)
          echo $excluded_resources
          included_resources=$(echo "$payload_body" |grep -A2 "### Included Resources" | tail -n1)
          echo $included_resources
          regions=$(echo "$payload_body" | grep -A2 "### Regions" | tail -n1)
          echo $regions
          nuke_resources=$(echo "$payload_body" | grep -A2 "### Nuke Resources" | tail -n1)
          echo $nuke_resources

      - name: Download and Extract 
        run: |
          mkdir aws-nuke
          wget -c https://github.com/rebuy-de/aws-nuke/releases/download/v2.25.0/aws-nuke-v2.25.0-linux-amd64.tar.gz -O - | tar -xz -C aws-nuke
          ./aws-nuke/aws-nuke-v2.25.0-linux-amd64 --help

      - name: install-aws-cli
        uses: unfor19/install-aws-cli-action@v1
        with:
          version: 2                         # default
          verbose: false                     # default
          arch: amd64          
          
      - name: Run-aws-version
        run: |
          /usr/local/bin/bash version
          shell: bash